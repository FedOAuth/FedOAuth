<html>
    <head>
        <title>Persona Provisioning</title>
        <script src="https://login.persona.org/provisioning_api.js"></script>
        <script type="text/javascript">
            var current_email = '{{user_email}}';

            function generateServerSide(email, publicKey, certDuration, callback)
            {

            }

            function startProvisioning()
            {
                navigator.id.beginProvisioning(function(email, certDuration) {
                    if (email == current_email) {
                        navigator.id.genKeyPair(function(publicKey) {
                            generateServerSide(email, publicKey, certDuration, function (certificate) {
                                navigator.id.registerCertificate(certificate);
                            });
                        });
                    } else {
                        navigator.id.raiseProvisioningFailure('user is not authenticated as target user');
                    }
                });
            }
        </script>
    </head>
    <body onLoad="startProvisioning()">
        This page is used internally by Persona.
    </body>
</html>
